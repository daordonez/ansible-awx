---
# Playbook principal - MenÃº interactivo para gestiÃ³n de usuarios Microsoft 365
- name: MenÃº Principal - GestiÃ³n de Usuarios Microsoft 365
  hosts: localhost
  connection: local
  gather_facts: false

  vars:
    tenant_id: "{{ vault_tenant_id | default('your-tenant-id') }}"
    client_id: "{{ vault_client_id | default('your-client-id') }}"
    client_secret: "{{ vault_client_secret | default('your-client-secret') }}"

  tasks:
    - name: Mostrar menÃº principal
      pause:
        prompt: |

          â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                      GESTIÃ“N DE USUARIOS MICROSOFT 365
          â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

          Seleccione la operaciÃ³n que desea realizar:

          1. ğŸ‘¤ CREAR nuevo usuario
          2. âœï¸  ACTUALIZAR usuario existente
          3. ğŸ—‘ï¸  ELIMINAR usuario
          4. ğŸ” CONSULTAR/BUSCAR usuarios
          5. âŒ SALIR

          Ingrese el nÃºmero de opciÃ³n (1-5)
      register: menu_option

    - name: Validar opciÃ³n del menÃº
      fail:
        msg: "OpciÃ³n no vÃ¡lida. Debe ingresar un nÃºmero del 1 al 5."
      when: menu_option.user_input | trim not in ['1', '2', '3', '4', '5']

    - name: Salir del menÃº
      debug:
        msg: |

          ğŸ‘‹ Gracias por usar el sistema de gestiÃ³n de usuarios Microsoft 365

          Â¡Hasta la prÃ³xima!
      when: menu_option.user_input | trim == '5'

    - name: Finalizar ejecuciÃ³n si se selecciona salir
      meta: end_play
      when: menu_option.user_input | trim == '5'

    - name: InformaciÃ³n sobre creaciÃ³n de usuarios
      debug:
        msg: |

          ğŸ”„ Ejecutando creaciÃ³n de usuarios...

          Por favor, ejecute el siguiente comando en una nueva terminal:
          ansible-playbook playbooks/users/create_users.yml --ask-vault-pass
      when: menu_option.user_input | trim == '1'

    - name: InformaciÃ³n sobre actualizaciÃ³n de usuarios
      debug:
        msg: |

          ğŸ”„ Ejecutando actualizaciÃ³n de usuarios...

          Por favor, ejecute el siguiente comando en una nueva terminal:
          ansible-playbook playbooks/users/update_users.yml --ask-vault-pass
      when: menu_option.user_input | trim == '2'

    - name: InformaciÃ³n sobre eliminaciÃ³n de usuarios
      debug:
        msg: |

          ğŸ”„ Ejecutando eliminaciÃ³n de usuarios...

          Por favor, ejecute el siguiente comando en una nueva terminal:
          ansible-playbook playbooks/users/delete_users.yml --ask-vault-pass
      when: menu_option.user_input | trim == '3'

    - name: InformaciÃ³n sobre consulta de usuarios
      debug:
        msg: |

          ğŸ”„ Ejecutando consulta de usuarios...

          Por favor, ejecute el siguiente comando en una nueva terminal:
          ansible-playbook playbooks/users/query_users.yml --ask-vault-pass
      when: menu_option.user_input | trim == '4'

    - name: Preguntar si desea realizar otra operaciÃ³n
      pause:
        prompt: |

          Â¿Desea realizar otra operaciÃ³n? (s/N)
      register: continue_operation
      when: menu_option.user_input | trim in ['1', '2', '3', '4']

    - name: Reiniciar menÃº si el usuario desea continuar
      include_tasks: "{{ playbook_dir }}/main_menu.yml"
      when:
        - menu_option.user_input | trim in ['1', '2', '3', '4']
        - (continue_operation.user_input | trim | lower) in ['s', 'si', 'yes', 'y']

    - name: Mensaje de despedida
      debug:
        msg: |

          âœ… OperaciÃ³n completada exitosamente

          ğŸ‘‹ Gracias por usar el sistema de gestiÃ³n de usuarios Microsoft 365
